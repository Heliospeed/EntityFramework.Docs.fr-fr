---
title: "Fonctionnement des requêtes - EF Core"
author: rowanmiller
ms.author: divega
ms.date: 10/27/2016
ms.assetid: de2e34cd-659b-4cab-b5ed-7a979c6bf120
ms.technology: entity-framework-core
uid: core/querying/overview
ms.openlocfilehash: 7fd2940d559f82016d7a8fc3fdcf3af0d5b8bc8f
ms.sourcegitcommit: 01a75cd483c1943ddd6f82af971f07abde20912e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/27/2017
---
# <a name="how-queries-work"></a><span data-ttu-id="25e1e-102">Fonctionnement des requêtes</span><span class="sxs-lookup"><span data-stu-id="25e1e-102">How Queries Work</span></span>

<span data-ttu-id="25e1e-103">Entity Framework Core utilise intégrer requête LINQ (Language) pour interroger des données à partir de la base de données.</span><span class="sxs-lookup"><span data-stu-id="25e1e-103">Entity Framework Core uses Language Integrate Query (LINQ) to query data from the database.</span></span> <span data-ttu-id="25e1e-104">LINQ vous permet d’utiliser c# (ou .NET langue de votre choix) pour écrire des requêtes fortement typées en fonction de vos classes dérivées de contexte et d’entité.</span><span class="sxs-lookup"><span data-stu-id="25e1e-104">LINQ allows you to use C# (or your .NET language of choice) to write strongly typed queries based on your derived context and entity classes.</span></span>

## <a name="the-life-of-a-query"></a><span data-ttu-id="25e1e-105">La durée de vie d’une requête</span><span class="sxs-lookup"><span data-stu-id="25e1e-105">The life of a query</span></span>

<span data-ttu-id="25e1e-106">Voici une vue d’ensemble de haut niveau du processus de que chaque requête parcourt.</span><span class="sxs-lookup"><span data-stu-id="25e1e-106">The following is a high level overview of the process each query goes through.</span></span>

1. <span data-ttu-id="25e1e-107">La requête LINQ est traitée par Entity Framework Core pour générer une représentation est prête à être traité par le fournisseur de base de données</span><span class="sxs-lookup"><span data-stu-id="25e1e-107">The LINQ query is processed by Entity Framework Core to build a representation that is ready to be processed by the database provider</span></span>
   1. <span data-ttu-id="25e1e-108">Le résultat est mis en cache afin que ce traitement n’a pas besoin d’être effectuée chaque fois que la requête est exécutée.</span><span class="sxs-lookup"><span data-stu-id="25e1e-108">The result is cached so that this processing does not need to be done every time the query is executed</span></span>
2. <span data-ttu-id="25e1e-109">Le résultat est transmis au fournisseur de base de données</span><span class="sxs-lookup"><span data-stu-id="25e1e-109">The result is passed to the database provider</span></span>
   1. <span data-ttu-id="25e1e-110">Le fournisseur de base de données identifie les parties de la requête peuvent être évaluées dans la base de données</span><span class="sxs-lookup"><span data-stu-id="25e1e-110">The database provider identifies which parts of the query can be evaluated in the database</span></span>
   2. <span data-ttu-id="25e1e-111">Ces parties de la requête sont traduites en langage de requête spécifique de base de données (par exemple, SQL pour une base de données relationnelle)</span><span class="sxs-lookup"><span data-stu-id="25e1e-111">These parts of the query are translated to database specific query language (e.g. SQL for a relational database)</span></span>
   3. <span data-ttu-id="25e1e-112">Une ou plusieurs requêtes sont envoyées à la base de données et le jeu de résultats retourné (résultats sont des valeurs de la base de données, et non des instances d’entité)</span><span class="sxs-lookup"><span data-stu-id="25e1e-112">One or more queries are sent to the database and the result set returned (results are values from the database, not entity instances)</span></span>
3. <span data-ttu-id="25e1e-113">Pour chaque élément du jeu de résultats</span><span class="sxs-lookup"><span data-stu-id="25e1e-113">For each item in the result set</span></span>
   1. <span data-ttu-id="25e1e-114">S’il s’agit d’une requête de suivi, EF vérifie si les données représentent une entité déjà dans le traceur de modifications pour l’instance de contexte</span><span class="sxs-lookup"><span data-stu-id="25e1e-114">If this is a tracking query, EF checks if the data represents an entity already in the change tracker for the context instance</span></span>
      * <span data-ttu-id="25e1e-115">Dans ce cas, l’entité existante est retournée.</span><span class="sxs-lookup"><span data-stu-id="25e1e-115">If so, the existing entity is returned</span></span>
      * <span data-ttu-id="25e1e-116">Si ce n’est pas le cas, une nouvelle entité est créée, le suivi des modifications est le programme d’installation, et la nouvelle entité est retournée.</span><span class="sxs-lookup"><span data-stu-id="25e1e-116">If not, a new entity is created, change tracking is setup, and the new entity is returned</span></span>
   2. <span data-ttu-id="25e1e-117">S’il s’agit d’une requête de suivi de non, EF vérifie si les données représentent une entité déjà dans le jeu de résultats pour cette requête</span><span class="sxs-lookup"><span data-stu-id="25e1e-117">If this is a no-tracking query, EF checks if the data represents an entity already in the result set for this query</span></span>
      * <span data-ttu-id="25e1e-118">Si, par conséquent, l’entité existante est retournée <sup>(1)</sup></span><span class="sxs-lookup"><span data-stu-id="25e1e-118">If so, the existing entity is returned <sup>(1)</sup></span></span>
      * <span data-ttu-id="25e1e-119">Dans le cas contraire, une nouvelle entité est créée et retournée</span><span class="sxs-lookup"><span data-stu-id="25e1e-119">If not, a new entity is created and returned</span></span>

<span data-ttu-id="25e1e-120"><sup>(1) </sup> Des requêtes de suivi sans utilisent des références faibles pour effectuer le suivi des entités qui ont déjà été retournées.</span><span class="sxs-lookup"><span data-stu-id="25e1e-120"><sup>(1)</sup> No tracking queries use weak references to keep track of entities that have already been returned.</span></span> <span data-ttu-id="25e1e-121">Si un résultat antérieur avec la même identité est hors de portée, et le garbage collection s’exécute, vous risquez d’obtenir une nouvelle instance de l’entité.</span><span class="sxs-lookup"><span data-stu-id="25e1e-121">If a previous result with the same identity goes out of scope, and garbage collection runs, you may get a new entity instance.</span></span>

## <a name="when-queries-are-executed"></a><span data-ttu-id="25e1e-122">Lorsque des requêtes sont exécutées.</span><span class="sxs-lookup"><span data-stu-id="25e1e-122">When queries are executed</span></span>

<span data-ttu-id="25e1e-123">Lorsque vous appelez des opérateurs LINQ, vous créez simplement une représentation en mémoire de la requête.</span><span class="sxs-lookup"><span data-stu-id="25e1e-123">When you call LINQ operators, you are simply building up an in-memory representation of the query.</span></span> <span data-ttu-id="25e1e-124">La requête est envoyée uniquement à la base de données lorsque les résultats sont consommés.</span><span class="sxs-lookup"><span data-stu-id="25e1e-124">The query is only sent to the database when the results are consumed.</span></span>

<span data-ttu-id="25e1e-125">Opérations qui génèrent les requêtes envoyées à la base de données les plus courantes sont :</span><span class="sxs-lookup"><span data-stu-id="25e1e-125">The most common operations that result in the query being sent to the database are:</span></span>
* <span data-ttu-id="25e1e-126">Itérer les résultats dans un `for` boucle</span><span class="sxs-lookup"><span data-stu-id="25e1e-126">Iterating the results in a `for` loop</span></span>
* <span data-ttu-id="25e1e-127">À l’aide d’un opérateur tel que `ToList`, `ToArray`, `Single`,`Count`</span><span class="sxs-lookup"><span data-stu-id="25e1e-127">Using an operator such as `ToList`, `ToArray`, `Single`, `Count`</span></span>
* <span data-ttu-id="25e1e-128">Liaison de données les résultats d’une requête à une interface utilisateur</span><span class="sxs-lookup"><span data-stu-id="25e1e-128">Databinding the results of a query to a UI</span></span>

> [!WARNING]  
> <span data-ttu-id="25e1e-129">**Validez toujours l’entrée d’utilisateur :** tandis que EF assure une protection contre les attaques par injection SQL, il n’effectue aucune validation générale d’entrée.</span><span class="sxs-lookup"><span data-stu-id="25e1e-129">**Always validate user input:** While EF does provide protection from SQL injection attacks, it does not do any general validation of input.</span></span> <span data-ttu-id="25e1e-130">Par conséquent, si les valeurs transmises aux API, utilisé dans les requêtes LINQ, affectées aux propriétés de l’entité, etc., proviennent d’une source non fiable, puis validation appropriées, selon vos besoins de l’application, doit être effectuée.</span><span class="sxs-lookup"><span data-stu-id="25e1e-130">Therefore if values being passed to APIs, used in LINQ queries, assigned to entity properties, etc., come from an untrusted source then appropriate validation, per your application requirements, should be performed.</span></span> <span data-ttu-id="25e1e-131">Cela inclut toute entrée d’utilisateur utilisée pour construire des requêtes de façon dynamique.</span><span class="sxs-lookup"><span data-stu-id="25e1e-131">This includes any user input used to dynamically construct queries.</span></span> <span data-ttu-id="25e1e-132">Même si vous utilisez LINQ, si vous acceptez d’entrée d’utilisateur pour générer des expressions, que vous devez vous assurer que seules les expressions prévues peut être construit.</span><span class="sxs-lookup"><span data-stu-id="25e1e-132">Even when using LINQ, if you are accepting user input to build expressions you need to make sure than only intended expressions can be constructed.</span></span>
