---
title: Mise à niveau à partir de versions précédentes vers EF Core 2 - EF Core
author: divega
ms.date: 08/13/2017
ms.assetid: 8BD43C8C-63D9-4F3A-B954-7BC518A1B7DB
uid: core/miscellaneous/1x-2x-upgrade
ms.openlocfilehash: 5371c8f3b7c6102c621296bbae145d13779e0c6e
ms.sourcegitcommit: 269c8a1a457a9ad27b4026c22c4b1a76991fb360
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/18/2018
ms.locfileid: "46283769"
---
# <a name="upgrading-applications-from-previous-versions-to-ef-core-20"></a><span data-ttu-id="94cc2-102">La mise à niveau des applications à partir de versions précédentes vers EF Core 2.0</span><span class="sxs-lookup"><span data-stu-id="94cc2-102">Upgrading applications from previous versions to EF Core 2.0</span></span>

<span data-ttu-id="94cc2-103">Nous avons saisi l’occasion pour affiner considérablement nos API existantes et les comportements de 2.0.</span><span class="sxs-lookup"><span data-stu-id="94cc2-103">We have taken the opportunity to significantly refine our existing APIs and behaviors in 2.0.</span></span> <span data-ttu-id="94cc2-104">Il existe quelques améliorations qui peuvent nécessiter la modification du code d’application existant, même si nous pensons que pour la majorité des applications l’impact sera faible, dans la plupart des cas nécessitant la recompilation et modifications guidées minimales pour remplacer les API obsolètes.</span><span class="sxs-lookup"><span data-stu-id="94cc2-104">There are a few improvements that can require modifying existing application code, although we believe that for the majority of applications the impact will be low, in most cases requiring just recompilation and minimal guided changes to replace obsolete APIs.</span></span>

<span data-ttu-id="94cc2-105">La mise à jour une application existante vers EF Core 2.0 peut nécessiter :</span><span class="sxs-lookup"><span data-stu-id="94cc2-105">Updating an existing application to EF Core 2.0 may require:</span></span>

1. <span data-ttu-id="94cc2-106">La mise à niveau de l’implémentation de .NET cible de l’application pour qu’il prend en charge .NET Standard 2.0.</span><span class="sxs-lookup"><span data-stu-id="94cc2-106">Upgrading the target .NET implementation of the application to one that supports .NET Standard 2.0.</span></span> <span data-ttu-id="94cc2-107">Consultez [pris en charge les implémentations .NET](../platforms/index.md) pour plus d’informations.</span><span class="sxs-lookup"><span data-stu-id="94cc2-107">See [Supported .NET Implementations](../platforms/index.md) for more details.</span></span>

2. <span data-ttu-id="94cc2-108">Identifier un fournisseur pour la base de données cible qui est compatible avec EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="94cc2-108">Identify a provider for the target database which is compatible with EF Core 2.0.</span></span> <span data-ttu-id="94cc2-109">Consultez [EF Core 2.0 requiert un fournisseur de base de 2.0 données](#ef-core-20-requires-a-20-database-provider) ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="94cc2-109">See [EF Core 2.0 requires a 2.0 database provider](#ef-core-20-requires-a-20-database-provider) below.</span></span>

3. <span data-ttu-id="94cc2-110">Mise à niveau tous les packages EF Core (runtime et des outils) vers la version 2.0.</span><span class="sxs-lookup"><span data-stu-id="94cc2-110">Upgrading all the EF Core packages (runtime and tooling) to 2.0.</span></span> <span data-ttu-id="94cc2-111">Reportez-vous à [installation d’EF Core](../get-started/install/index.md) pour plus d’informations.</span><span class="sxs-lookup"><span data-stu-id="94cc2-111">Refer to [Installing EF Core](../get-started/install/index.md) for more details.</span></span>

4. <span data-ttu-id="94cc2-112">Apporter des modifications de code nécessaire pour compenser les modifications avec rupture décrites dans le reste de ce document.</span><span class="sxs-lookup"><span data-stu-id="94cc2-112">Make any necessary code changes to compensate for the breaking changes described in the rest of this document.</span></span>

## <a name="aspnet-core-now-includes-ef-core"></a><span data-ttu-id="94cc2-113">ASP.NET Core inclut désormais EF Core</span><span class="sxs-lookup"><span data-stu-id="94cc2-113">ASP.NET Core now includes EF Core</span></span>

<span data-ttu-id="94cc2-114">Les applications ciblant ASP.NET Core 2.0 peuvent utiliser EF Core 2.0 sans dépendances supplémentaires en plus des fournisseurs de base de données tiers.</span><span class="sxs-lookup"><span data-stu-id="94cc2-114">Applications targeting ASP.NET Core 2.0 can use EF Core 2.0 without additional dependencies besides third party database providers.</span></span> <span data-ttu-id="94cc2-115">Toutefois, les applications ciblant des versions antérieures d’ASP.NET Core doivent mettre à niveau vers ASP.NET Core 2.0 pour pouvoir utiliser EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="94cc2-115">However, applications targeting previous versions of ASP.NET Core need to upgrade to ASP.NET Core 2.0 in order to use EF Core 2.0.</span></span> <span data-ttu-id="94cc2-116">Pour plus d’informations sur la mise à niveau vers la version 2.0, les applications ASP.NET Core, consultez [la documentation ASP.NET Core sur le sujet](https://docs.microsoft.com/aspnet/core/migration/1x-to-2x/).</span><span class="sxs-lookup"><span data-stu-id="94cc2-116">For more details on upgrading ASP.NET Core applications to 2.0 see [the ASP.NET Core documentation on the subject](https://docs.microsoft.com/aspnet/core/migration/1x-to-2x/).</span></span>

## <a name="new-way-of-getting-application-services-in-aspnet-core"></a><span data-ttu-id="94cc2-117">Nouvelle façon d’obtenir des services d’application dans ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="94cc2-117">New way of getting application services in ASP.NET Core</span></span>

<span data-ttu-id="94cc2-118">Le modèle recommandé pour les applications web ASP.NET Core a été mis à jour pour 2.0 d’une manière qui a interrompu la logique au moment du design QU'EF Core est utilisé dans la version 1.x.</span><span class="sxs-lookup"><span data-stu-id="94cc2-118">The recommended pattern for ASP.NET Core web applications has been updated for 2.0 in a way that broke the design-time logic EF Core used in 1.x.</span></span> <span data-ttu-id="94cc2-119">Précédemment au moment du design, EF Core tentait d’appeler `Startup.ConfigureServices` directement afin d’accéder au fournisseur de service de l’application.</span><span class="sxs-lookup"><span data-stu-id="94cc2-119">Previously at design-time, EF Core would try to invoke `Startup.ConfigureServices` directly in order to access the application's service provider.</span></span> <span data-ttu-id="94cc2-120">Dans ASP.NET Core 2.0, la Configuration est initialisée à l’extérieur de la `Startup` classe.</span><span class="sxs-lookup"><span data-stu-id="94cc2-120">In ASP.NET Core 2.0, Configuration is initialized outside of the `Startup` class.</span></span> <span data-ttu-id="94cc2-121">Applications à l’aide d’EF Core généralement accèdent leur chaîne de connexion à partir de la Configuration, `Startup` en lui-même n’est plus suffisante.</span><span class="sxs-lookup"><span data-stu-id="94cc2-121">Applications using EF Core typically access their connection string from Configuration, so `Startup` by itself is no longer sufficient.</span></span> <span data-ttu-id="94cc2-122">Si vous mettez à niveau une application 1.x de ASP.NET Core, vous pouvez recevoir l’erreur suivante lorsque vous utilisez les outils EF Core.</span><span class="sxs-lookup"><span data-stu-id="94cc2-122">If you upgrade an ASP.NET Core 1.x application, you may receive the following error when using the EF Core tools.</span></span>

> <span data-ttu-id="94cc2-123">Aucun constructeur sans paramètre a été trouvé sur « ApplicationContext ».</span><span class="sxs-lookup"><span data-stu-id="94cc2-123">No parameterless constructor was found on 'ApplicationContext'.</span></span> <span data-ttu-id="94cc2-124">Ajoutez un constructeur sans paramètre à « ApplicationContext » ou ajouter une implémentation de « IDesignTimeDbContextFactory&lt;ApplicationContext&gt;» dans le même assembly que 'ApplicationContext'</span><span class="sxs-lookup"><span data-stu-id="94cc2-124">Either add a parameterless constructor to 'ApplicationContext' or add an implementation of 'IDesignTimeDbContextFactory&lt;ApplicationContext&gt;' in the same assembly as 'ApplicationContext'</span></span>

<span data-ttu-id="94cc2-125">Un nouveau hook au moment du design a été ajouté dans le modèle de valeur par défaut d’ASP.NET Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="94cc2-125">A new design-time hook has been added in ASP.NET Core 2.0's default template.</span></span> <span data-ttu-id="94cc2-126">La méthode statique `Program.BuildWebHost` méthode permet d’EF Core pour accéder à fournisseur de services de l’application au moment du design.</span><span class="sxs-lookup"><span data-stu-id="94cc2-126">The static `Program.BuildWebHost` method enables EF Core to access the application's service provider at design time.</span></span> <span data-ttu-id="94cc2-127">Si vous mettez à niveau une application 1.x de ASP.NET Core, vous devez mettre à jour le `Program` classe ressemble à ce qui suit.</span><span class="sxs-lookup"><span data-stu-id="94cc2-127">If you are upgrading an ASP.NET Core 1.x application, you will need to update the `Program` class to resemble the following.</span></span>

``` csharp
using Microsoft.AspNetCore;
using Microsoft.AspNetCore.Hosting;

namespace AspNetCoreDotNetCore2._0App
{
    public class Program
    {
        public static void Main(string[] args)
        {
            BuildWebHost(args).Run();
        }

        public static IWebHost BuildWebHost(string[] args) =>
            WebHost.CreateDefaultBuilder(args)
                .UseStartup<Startup>()
                .Build();
    }
}
```

<span data-ttu-id="94cc2-128">L’adoption de ce nouveau modèle lors de la mise à jour des applications vers la version 2.0 est vivement recommandée et est obligatoire pour les fonctionnalités de produit, comme des Migrations Entity Framework Core fonctionne.</span><span class="sxs-lookup"><span data-stu-id="94cc2-128">The adoption of this new pattern when updating applications to 2.0 is highly recommended and is required in order for product features like Entity Framework Core Migrations to work.</span></span> <span data-ttu-id="94cc2-129">L’autre alternative courante consiste à [implémenter *IDesignTimeDbContextFactory\<TContext >*](xref:core/miscellaneous/cli/dbcontext-creation#from-a-design-time-factory).</span><span class="sxs-lookup"><span data-stu-id="94cc2-129">The other common alternative is to [implement *IDesignTimeDbContextFactory\<TContext>*](xref:core/miscellaneous/cli/dbcontext-creation#from-a-design-time-factory).</span></span>

## <a name="idbcontextfactory-renamed"></a><span data-ttu-id="94cc2-130">IDbContextFactory renommé</span><span class="sxs-lookup"><span data-stu-id="94cc2-130">IDbContextFactory renamed</span></span>

<span data-ttu-id="94cc2-131">Afin de prendre en charge les modèles de diverses applications et de donner aux utilisateurs de contrôler la façon leurs `DbContext` est utilisé au moment du design, nous vous proposons, dans le passé, la `IDbContextFactory<TContext>` interface.</span><span class="sxs-lookup"><span data-stu-id="94cc2-131">In order to support diverse application patterns and give users more control over how their `DbContext` is used at design time, we have, in the past, provided the `IDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="94cc2-132">Au moment du design, les outils EF Core détecte des implémentations de cette interface dans votre projet et utilisez-le pour créer `DbContext` objets.</span><span class="sxs-lookup"><span data-stu-id="94cc2-132">At design-time, the EF Core tools will discover implementations of this interface in your project and use it to create `DbContext` objects.</span></span>

<span data-ttu-id="94cc2-133">Cette interface a un nom très général qui induire en erreur certains utilisateurs à essayer de nouveau l’utiliser pour d’autres `DbContext`-création de scénarios.</span><span class="sxs-lookup"><span data-stu-id="94cc2-133">This interface had a very general name which mislead some users to try re-using it for other `DbContext`-creating scenarios.</span></span> <span data-ttu-id="94cc2-134">Ils ont été prises au dépourvu lorsque les outils EF puis a tenté d’utiliser leur implémentation au moment du design et a provoqué des commandes telles que `Update-Database` ou `dotnet ef database update` échec.</span><span class="sxs-lookup"><span data-stu-id="94cc2-134">They were caught off guard when the EF Tools then tried to use their implementation at design-time and caused commands like `Update-Database` or `dotnet ef database update` to fail.</span></span>

<span data-ttu-id="94cc2-135">Afin de communiquer la sémantique au moment du design forte de cette interface, nous avons renommé à `IDesignTimeDbContextFactory<TContext>`.</span><span class="sxs-lookup"><span data-stu-id="94cc2-135">In order to communicate the strong design-time semantics of this interface, we have renamed it to `IDesignTimeDbContextFactory<TContext>`.</span></span>

<span data-ttu-id="94cc2-136">Pour 2.0 libérer le `IDbContextFactory<TContext>` existe toujours, mais est marqué comme obsolète.</span><span class="sxs-lookup"><span data-stu-id="94cc2-136">For the 2.0 release the `IDbContextFactory<TContext>` still exists but is marked as obsolete.</span></span>

## <a name="dbcontextfactoryoptions-removed"></a><span data-ttu-id="94cc2-137">DbContextFactoryOptions supprimées</span><span class="sxs-lookup"><span data-stu-id="94cc2-137">DbContextFactoryOptions removed</span></span>

<span data-ttu-id="94cc2-138">En raison des modifications d’ASP.NET Core 2.0 décrites ci-dessus, nous avons découvert que `DbContextFactoryOptions` était n’est plus nécessaire sur le nouveau `IDesignTimeDbContextFactory<TContext>` interface.</span><span class="sxs-lookup"><span data-stu-id="94cc2-138">Because of the ASP.NET Core 2.0 changes described above, we found that `DbContextFactoryOptions` was no longer needed on the new `IDesignTimeDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="94cc2-139">Voici les alternatives que vous devez utiliser à la place.</span><span class="sxs-lookup"><span data-stu-id="94cc2-139">Here are the alternatives you should be using instead.</span></span>

| <span data-ttu-id="94cc2-140">DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="94cc2-140">DbContextFactoryOptions</span></span> | <span data-ttu-id="94cc2-141">Alternative</span><span class="sxs-lookup"><span data-stu-id="94cc2-141">Alternative</span></span>                                                  |
|:------------------------|:-------------------------------------------------------------|
| <span data-ttu-id="94cc2-142">ApplicationBasePath</span><span class="sxs-lookup"><span data-stu-id="94cc2-142">ApplicationBasePath</span></span>     | <span data-ttu-id="94cc2-143">AppContext.BaseDirectory</span><span class="sxs-lookup"><span data-stu-id="94cc2-143">AppContext.BaseDirectory</span></span>                                     |
| <span data-ttu-id="94cc2-144">ContentRootPath</span><span class="sxs-lookup"><span data-stu-id="94cc2-144">ContentRootPath</span></span>         | <span data-ttu-id="94cc2-145">Directory.GetCurrentDirectory()</span><span class="sxs-lookup"><span data-stu-id="94cc2-145">Directory.GetCurrentDirectory()</span></span>                              |
| <span data-ttu-id="94cc2-146">EnvironmentName</span><span class="sxs-lookup"><span data-stu-id="94cc2-146">EnvironmentName</span></span>         | <span data-ttu-id="94cc2-147">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span><span class="sxs-lookup"><span data-stu-id="94cc2-147">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span></span> |

## <a name="design-time-working-directory-changed"></a><span data-ttu-id="94cc2-148">Répertoire de travail au moment du design modifié</span><span class="sxs-lookup"><span data-stu-id="94cc2-148">Design-time working directory changed</span></span>

<span data-ttu-id="94cc2-149">Les modifications de ASP.NET Core 2.0 requises également le répertoire de travail utilisé par `dotnet ef` pour s’aligner avec le répertoire de travail utilisé par Visual Studio lors de l’exécution de votre application.</span><span class="sxs-lookup"><span data-stu-id="94cc2-149">The ASP.NET Core 2.0 changes also required the working directory used by `dotnet ef` to align with the working directory used by Visual Studio when running your application.</span></span> <span data-ttu-id="94cc2-150">Un effet secondaire observable de ce est que SQLite noms de fichiers sont désormais relatif du répertoire du projet et non au répertoire de sortie comme à réaliser.</span><span class="sxs-lookup"><span data-stu-id="94cc2-150">One observable side effect of this is that SQLite filenames are now relative to the project directory and not the output directory like they used to be.</span></span>

## <a name="ef-core-20-requires-a-20-database-provider"></a><span data-ttu-id="94cc2-151">EF Core 2.0 requiert un fournisseur de base de 2.0 données</span><span class="sxs-lookup"><span data-stu-id="94cc2-151">EF Core 2.0 requires a 2.0 database provider</span></span>

<span data-ttu-id="94cc2-152">Pour EF Core 2.0 nous avons apporté plusieurs simplifications et les améliorations dans les fournisseurs de base de données de façon fonctionne.</span><span class="sxs-lookup"><span data-stu-id="94cc2-152">For EF Core 2.0 we have made many simplifications and improvements in the way database providers work.</span></span> <span data-ttu-id="94cc2-153">Cela signifie que les fournisseurs 1.0.x et 1.1.x ne fonctionnera pas avec EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="94cc2-153">This means that 1.0.x and 1.1.x providers will not work with EF Core 2.0.</span></span>

<span data-ttu-id="94cc2-154">Les fournisseurs SQL Server et SQLite sont fournis par l’équipe EF et les 2.0 versions sera disponibles dans le cadre de 2.0 release.</span><span class="sxs-lookup"><span data-stu-id="94cc2-154">The SQL Server and SQLite providers are shipped by the EF team and 2.0 versions will be available as part of the 2.0 release.</span></span> <span data-ttu-id="94cc2-155">Les fournisseurs tiers open source pour [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), et [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) sont mis à jour pour 2.0.</span><span class="sxs-lookup"><span data-stu-id="94cc2-155">The open-source third party providers for [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), and [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) are being updated for 2.0.</span></span> <span data-ttu-id="94cc2-156">Pour tous les autres fournisseurs, veuillez contacter le rédacteur de fournisseur.</span><span class="sxs-lookup"><span data-stu-id="94cc2-156">For all other providers, please contact the provider writer.</span></span>

## <a name="logging-and-diagnostics-events-have-changed"></a><span data-ttu-id="94cc2-157">Événements de journalisation et de diagnostic ont été modifiés.</span><span class="sxs-lookup"><span data-stu-id="94cc2-157">Logging and Diagnostics events have changed</span></span>

<span data-ttu-id="94cc2-158">Remarque : ces modifications ne devraient pas avoir un impact sur la plupart des codes d’application.</span><span class="sxs-lookup"><span data-stu-id="94cc2-158">Note: these changes should not impact most application code.</span></span>

<span data-ttu-id="94cc2-159">Les ID d’événement pour les messages envoyés à un [ILogger](https://github.com/aspnet/Logging/blob/dev/src/Microsoft.Extensions.Logging.Abstractions/ILogger.cs) ont été modifiés dans 2.0.</span><span class="sxs-lookup"><span data-stu-id="94cc2-159">The event IDs for messages sent to an [ILogger](https://github.com/aspnet/Logging/blob/dev/src/Microsoft.Extensions.Logging.Abstractions/ILogger.cs) have changed in 2.0.</span></span> <span data-ttu-id="94cc2-160">Les ID d’événement sont maintenant uniques dans le code EF Core.</span><span class="sxs-lookup"><span data-stu-id="94cc2-160">The event IDs are now unique across EF Core code.</span></span> <span data-ttu-id="94cc2-161">En outre, ces messages suivent désormais le modèle standard de la journalisation structurée utilisé, par exemple, par le modèle MVC.</span><span class="sxs-lookup"><span data-stu-id="94cc2-161">These messages now also follow the standard pattern for structured logging used by, for example, MVC.</span></span>

<span data-ttu-id="94cc2-162">Les catégories d’enregistreurs d’événements ont également changé.</span><span class="sxs-lookup"><span data-stu-id="94cc2-162">Logger categories have also changed.</span></span> <span data-ttu-id="94cc2-163">Il existe désormais un jeu connu de catégories accessibles par le biais de [DbLoggerCategory](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/DbLoggerCategory.cs).</span><span class="sxs-lookup"><span data-stu-id="94cc2-163">There is now a well-known set of categories accessed through [DbLoggerCategory](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/DbLoggerCategory.cs).</span></span>

<span data-ttu-id="94cc2-164">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) événements utilisent désormais les mêmes noms de ID d’événement correspondants `ILogger` messages.</span><span class="sxs-lookup"><span data-stu-id="94cc2-164">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) events now use the same event ID names as the corresponding `ILogger` messages.</span></span> <span data-ttu-id="94cc2-165">Les charges utiles d’événement sont tous les types nominaux dérivés [EventData](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/EventData.cs).</span><span class="sxs-lookup"><span data-stu-id="94cc2-165">The event payloads are all nominal types derived from [EventData](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/EventData.cs).</span></span>

<span data-ttu-id="94cc2-166">ID d’événement, les types de charge utile et les catégories sont décrits dans le [CoreEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/CoreEventId.cs) et [RelationalEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore.Relational/Diagnostics/RelationalEventId.cs) classes.</span><span class="sxs-lookup"><span data-stu-id="94cc2-166">Event IDs, payload types, and categories are documented in the [CoreEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Diagnostics/CoreEventId.cs) and the [RelationalEventId](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore.Relational/Diagnostics/RelationalEventId.cs) classes.</span></span>

<span data-ttu-id="94cc2-167">ID ont également été déplacés à partir de Microsoft.EntityFrameworkCore.Infraestructure pour le nouvel espace de noms Microsoft.EntityFrameworkCore.Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="94cc2-167">IDs have also moved from Microsoft.EntityFrameworkCore.Infraestructure to the new Microsoft.EntityFrameworkCore.Diagnostics namespace.</span></span>

## <a name="ef-core-relational-metadata-api-changes"></a><span data-ttu-id="94cc2-168">Modifications de métadonnées relationnelles API EF Core</span><span class="sxs-lookup"><span data-stu-id="94cc2-168">EF Core relational metadata API changes</span></span>

<span data-ttu-id="94cc2-169">EF Core 2.0 génère désormais un [IModel](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IModel.cs) différent par fournisseur utilisé.</span><span class="sxs-lookup"><span data-stu-id="94cc2-169">EF Core 2.0 will now build a different [IModel](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IModel.cs) for each different provider being used.</span></span> <span data-ttu-id="94cc2-170">Cela est généralement transparent pour l’application.</span><span class="sxs-lookup"><span data-stu-id="94cc2-170">This is usually transparent to the application.</span></span> <span data-ttu-id="94cc2-171">Il en résulte une simplification des API de métadonnées de niveau inférieur, au point que tout accès aux _concepts de métadonnées relationnelles communs_ est toujours établi par le biais d’un appel à `.Relational` au lieu de `.SqlServer`, `.Sqlite`, etc. Par exemple, 1.1.x code similaire à celui-ci :</span><span class="sxs-lookup"><span data-stu-id="94cc2-171">This has facilitated a simplification of lower-level metadata APIs such that any access to _common relational metadata concepts_ is always made through a call to `.Relational` instead of `.SqlServer`, `.Sqlite`, etc. For example, 1.1.x code like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).SqlServer().TableName;
```

<span data-ttu-id="94cc2-172">Doit maintenant être écrit comme suit :</span><span class="sxs-lookup"><span data-stu-id="94cc2-172">Should now be written like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).Relational().TableName;
```

<span data-ttu-id="94cc2-173">Au lieu d’utiliser des méthodes telles que `ForSqlServerToTable`, méthodes d’extension sont désormais disponibles pour écrire du code conditionnel basé sur le fournisseur actuel en cours d’utilisation.</span><span class="sxs-lookup"><span data-stu-id="94cc2-173">Instead of using methods like `ForSqlServerToTable`, extension methods are now available to write conditional code based on the current provider in use.</span></span> <span data-ttu-id="94cc2-174">Exemple :</span><span class="sxs-lookup"><span data-stu-id="94cc2-174">For example:</span></span>

```C#
modelBuilder.Entity<User>().ToTable(
    Database.IsSqlServer() ? "SqlServerName" : "OtherName");
```

<span data-ttu-id="94cc2-175">Notez que cette modification s’applique uniquement aux API/métadonnées qui est définie pour _tous les_ fournisseurs relationnelles.</span><span class="sxs-lookup"><span data-stu-id="94cc2-175">Note that this change only applies to APIs/metadata that is defined for _all_ relational providers.</span></span> <span data-ttu-id="94cc2-176">Les API et les métadonnées reste la même lorsqu’il est spécifique à un seul fournisseur.</span><span class="sxs-lookup"><span data-stu-id="94cc2-176">The API and metadata remains the same when it is specific to only a single provider.</span></span> <span data-ttu-id="94cc2-177">Par exemple, les index ordonnés en clusters sont spécifiques à SQL Server, donc `ForSqlServerIsClustered` et `.SqlServer().IsClustered()` doit toujours être utilisé.</span><span class="sxs-lookup"><span data-stu-id="94cc2-177">For example, clustered indexes are specific to SQL Sever, so `ForSqlServerIsClustered` and  `.SqlServer().IsClustered()` must still be used.</span></span>

## <a name="dont-take-control-of-the-ef-service-provider"></a><span data-ttu-id="94cc2-178">Ne pas prendre le contrôle du fournisseur de services EF</span><span class="sxs-lookup"><span data-stu-id="94cc2-178">Don’t take control of the EF service provider</span></span>

<span data-ttu-id="94cc2-179">EF Core utilise un interne `IServiceProvider` (un conteneur d’injection de dépendance) pour son implémentation interne.</span><span class="sxs-lookup"><span data-stu-id="94cc2-179">EF Core uses an internal `IServiceProvider` (a dependency injection container) for its internal implementation.</span></span> <span data-ttu-id="94cc2-180">Les applications doivent autoriser EF Core créer et gérer ce fournisseur, sauf dans des cas spéciaux.</span><span class="sxs-lookup"><span data-stu-id="94cc2-180">Applications should allow EF Core to create and manage this provider except in special cases.</span></span> <span data-ttu-id="94cc2-181">Fortement envisager de supprimer tous les appels à `UseInternalServiceProvider`.</span><span class="sxs-lookup"><span data-stu-id="94cc2-181">Strongly consider removing any calls to `UseInternalServiceProvider`.</span></span> <span data-ttu-id="94cc2-182">Si une application a besoin d’appeler `UseInternalServiceProvider`, puis pensez à [signalant un problème](https://github.com/aspnet/EntityFramework/Issues) donc nous pouvons examiner d’autres façons de gérer votre scénario.</span><span class="sxs-lookup"><span data-stu-id="94cc2-182">If an application does need to call `UseInternalServiceProvider`, then please consider [filing an issue](https://github.com/aspnet/EntityFramework/Issues) so we can investigate other ways to handle your scenario.</span></span>

<span data-ttu-id="94cc2-183">Appel `AddEntityFramework`, `AddEntityFrameworkSqlServer`, etc. n’est pas requis par code d’application, sauf si `UseInternalServiceProvider` est également appelée.</span><span class="sxs-lookup"><span data-stu-id="94cc2-183">Calling `AddEntityFramework`, `AddEntityFrameworkSqlServer`, etc. is not required by application code unless `UseInternalServiceProvider` is also called.</span></span> <span data-ttu-id="94cc2-184">Supprimer tous les appels à `AddEntityFramework` ou `AddEntityFrameworkSqlServer`, etc. `AddDbContext` doit toujours être utilisé dans la même façon qu’avant.</span><span class="sxs-lookup"><span data-stu-id="94cc2-184">Remove any existing calls to `AddEntityFramework` or `AddEntityFrameworkSqlServer`, etc. `AddDbContext` should still be used in the same way as before.</span></span>

## <a name="in-memory-databases-must-be-named"></a><span data-ttu-id="94cc2-185">Bases de données en mémoire doivent être nommés.</span><span class="sxs-lookup"><span data-stu-id="94cc2-185">In-memory databases must be named</span></span>

<span data-ttu-id="94cc2-186">La base de données en mémoire sans nom global a été supprimée et à la place toutes les bases de données en mémoire doivent être nommés.</span><span class="sxs-lookup"><span data-stu-id="94cc2-186">The global unnamed in-memory database has been removed and instead all in-memory databases must be named.</span></span> <span data-ttu-id="94cc2-187">Exemple :</span><span class="sxs-lookup"><span data-stu-id="94cc2-187">For example:</span></span>

``` csharp
optionsBuilder.UseInMemoryDatabase("MyDatabase");
```

<span data-ttu-id="94cc2-188">Cela crée/utilise une base de données portant le nom « MyDatabase ».</span><span class="sxs-lookup"><span data-stu-id="94cc2-188">This creates/uses a database with the name “MyDatabase”.</span></span> <span data-ttu-id="94cc2-189">Si `UseInMemoryDatabase` est appelée à nouveau avec le même nom, la même base de données en mémoire est utilisé, ce qui lui permet d’être partagé par plusieurs instances de contexte.</span><span class="sxs-lookup"><span data-stu-id="94cc2-189">If `UseInMemoryDatabase` is called again with the same name, then the same in-memory database will be used, allowing it to be shared by multiple context instances.</span></span>

## <a name="read-only-api-changes"></a><span data-ttu-id="94cc2-190">Modifications de l’API en lecture seule</span><span class="sxs-lookup"><span data-stu-id="94cc2-190">Read-only API changes</span></span>

<span data-ttu-id="94cc2-191">`IsReadOnlyBeforeSave`, `IsReadOnlyAfterSave`, et `IsStoreGeneratedAlways` ont été obsolète et remplacé par [BeforeSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L39) et [AfterSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L55).</span><span class="sxs-lookup"><span data-stu-id="94cc2-191">`IsReadOnlyBeforeSave`, `IsReadOnlyAfterSave`, and `IsStoreGeneratedAlways` have been obsoleted and replaced with [BeforeSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L39) and [AfterSaveBehavior](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/IProperty.cs#L55).</span></span> <span data-ttu-id="94cc2-192">Ces comportements s’appliquent à n’importe quelle propriété (générées par le magasin non seulement des propriétés) et déterminer comment la valeur de la propriété doit être utilisée lors de l’insertion dans une ligne de base de données (`BeforeSaveBehavior`) ou lorsque la mise à jour existant de base de données ligne (`AfterSaveBehavior`).</span><span class="sxs-lookup"><span data-stu-id="94cc2-192">These behaviors apply to any property (not only store-generated properties) and determine how the value of the property should be used when inserting into a database row (`BeforeSaveBehavior`) or when updating an existing database row (`AfterSaveBehavior`).</span></span>

<span data-ttu-id="94cc2-193">Propriétés marquées comme étant [ValueGenerated.OnAddOrUpdate](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/ValueGenerated.cs) (par exemple, pour les colonnes calculées) par défaut ignore toute valeur actuellement définie sur la propriété.</span><span class="sxs-lookup"><span data-stu-id="94cc2-193">Properties marked as [ValueGenerated.OnAddOrUpdate](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/ValueGenerated.cs) (for example, for computed columns) will by default ignore any value currently set on the property.</span></span> <span data-ttu-id="94cc2-194">Cela signifie qu’une valeur générée par le magasin sera toujours obtenue indépendamment de si n’importe quelle valeur a été définie ou modifiée sur l’entité suivie.</span><span class="sxs-lookup"><span data-stu-id="94cc2-194">This means that a store-generated value will always be obtained regardless of whether any value has been set or modified on the tracked entity.</span></span> <span data-ttu-id="94cc2-195">Cela peut être modifié en définissant un autre `Before\AfterSaveBehavior`.</span><span class="sxs-lookup"><span data-stu-id="94cc2-195">This can be changed by setting a different `Before\AfterSaveBehavior`.</span></span>

## <a name="new-clientsetnull-delete-behavior"></a><span data-ttu-id="94cc2-196">Nouveau comportement de suppression ClientSetNull</span><span class="sxs-lookup"><span data-stu-id="94cc2-196">New ClientSetNull delete behavior</span></span>

<span data-ttu-id="94cc2-197">Dans les versions précédentes, [DeleteBehavior.Restrict](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/DeleteBehavior.cs) avait un comportement pour les entités suivies par le contexte que plus fermé mise en correspondance `SetNull` sémantique.</span><span class="sxs-lookup"><span data-stu-id="94cc2-197">In previous releases, [DeleteBehavior.Restrict](https://github.com/aspnet/EntityFramework/blob/dev/src/EFCore/Metadata/DeleteBehavior.cs) had a behavior for entities tracked by the context that more closed matched `SetNull` semantics.</span></span> <span data-ttu-id="94cc2-198">Dans EF Core 2.0, un nouveau `ClientSetNull` comportement a été introduit en tant que la valeur par défaut pour les relations facultatives.</span><span class="sxs-lookup"><span data-stu-id="94cc2-198">In EF Core 2.0, a new `ClientSetNull` behavior has been introduced as the default for optional relationships.</span></span> <span data-ttu-id="94cc2-199">Ce comportement a `SetNull` sémantique pour les entités suivies et `Restrict` comportement pour les bases de données créées à l’aide d’EF Core.</span><span class="sxs-lookup"><span data-stu-id="94cc2-199">This behavior has `SetNull` semantics for tracked entities and `Restrict` behavior for databases created using EF Core.</span></span> <span data-ttu-id="94cc2-200">Dans notre expérience, il s’agit des plus attendue/comportements utiles pour les entités suivies et la base de données.</span><span class="sxs-lookup"><span data-stu-id="94cc2-200">In our experience, these are the most expected/useful behaviors for tracked entities and the database.</span></span> <span data-ttu-id="94cc2-201">`DeleteBehavior.Restrict` est maintenant respectée pour les entités suivies lorsque la valeur pour les relations facultatives.</span><span class="sxs-lookup"><span data-stu-id="94cc2-201">`DeleteBehavior.Restrict` is now honored for tracked entities when set for optional relationships.</span></span>

## <a name="provider-design-time-packages-removed"></a><span data-ttu-id="94cc2-202">Packages au moment du design de fournisseur supprimés</span><span class="sxs-lookup"><span data-stu-id="94cc2-202">Provider design-time packages removed</span></span>

<span data-ttu-id="94cc2-203">Le `Microsoft.EntityFrameworkCore.Relational.Design` package a été supprimé.</span><span class="sxs-lookup"><span data-stu-id="94cc2-203">The `Microsoft.EntityFrameworkCore.Relational.Design` package has been removed.</span></span> <span data-ttu-id="94cc2-204">Son contenu ont été consolidés en `Microsoft.EntityFrameworkCore.Relational` et `Microsoft.EntityFrameworkCore.Design`.</span><span class="sxs-lookup"><span data-stu-id="94cc2-204">It's contents were consolidated into `Microsoft.EntityFrameworkCore.Relational` and `Microsoft.EntityFrameworkCore.Design`.</span></span>

<span data-ttu-id="94cc2-205">Cela se propage dans les packages au moment du design de fournisseur.</span><span class="sxs-lookup"><span data-stu-id="94cc2-205">This propagates into the provider design-time packages.</span></span> <span data-ttu-id="94cc2-206">Ces packages (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, etc.) ont été supprimés et leur contenu consolidées dans les packages fournisseur principal.</span><span class="sxs-lookup"><span data-stu-id="94cc2-206">Those packages (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, etc.) were removed and their contents consolidated into the main provider packages.</span></span>

<span data-ttu-id="94cc2-207">Pour activer `Scaffold-DbContext` ou `dotnet ef dbcontext scaffold` dans EF Core 2.0, il vous suffit de référencer le package de fournisseur unique :</span><span class="sxs-lookup"><span data-stu-id="94cc2-207">To enable `Scaffold-DbContext` or `dotnet ef dbcontext scaffold` in EF Core 2.0, you only need to reference the single provider package:</span></span>

``` xml
<PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer"
    Version="2.0.0" />
<PackageReference Include="Microsoft.EntityFrameworkCore.Tools"
    Version="2.0.0"
    PrivateAssets="All" />
<DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet"
    Version="2.0.0" />
```
