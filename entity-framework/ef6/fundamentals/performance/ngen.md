---
title: Amélioration des performances de démarrage avec NGen - EF6
author: divega
ms.date: 10/23/2016
ms.assetid: dc6110a0-80a0-4370-8190-cea942841cee
ms.openlocfilehash: 2e9a93c7741046da25b890fed084a6b280bf5643
ms.sourcegitcommit: 2b787009fd5be5627f1189ee396e708cd130e07b
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/13/2018
ms.locfileid: "45489958"
---
# <a name="improving-startup-performance-with-ngen"></a><span data-ttu-id="60df7-102">Amélioration des performances de démarrage avec NGen</span><span class="sxs-lookup"><span data-stu-id="60df7-102">Improving startup performance with NGen</span></span>
> [!NOTE]
> <span data-ttu-id="60df7-103">**EF6 et versions ultérieures uniquement** : Les fonctionnalités, les API, etc. décrites dans cette page ont été introduites dans Entity Framework 6.</span><span class="sxs-lookup"><span data-stu-id="60df7-103">**EF6 Onwards Only** - The features, APIs, etc. discussed in this page were introduced in Entity Framework 6.</span></span> <span data-ttu-id="60df7-104">Si vous utilisez une version antérieure, certaines ou toutes les informations ne s’appliquent pas.</span><span class="sxs-lookup"><span data-stu-id="60df7-104">If you are using an earlier version, some or all of the information does not apply.</span></span>  

<span data-ttu-id="60df7-105">Le .NET Framework prend en charge la génération d’images natives pour les applications gérées et bibliothèques comme un moyen pour aider les applications à démarrer plus rapidement, ainsi que dans certains cas utilisent moins de mémoire.</span><span class="sxs-lookup"><span data-stu-id="60df7-105">The .NET Framework supports the generation of native images for managed applications and libraries as a way to help applications start faster and also in some cases use less memory.</span></span> <span data-ttu-id="60df7-106">Les images natives sont créés en traduisant les assemblys de code managé dans des fichiers contenant des instructions machine natives avant l’exécution de l’application, ce qui décharge le compilateur .NET JIT (juste-à-temps) d’avoir à générer les instructions natives au exécution de l’application.</span><span class="sxs-lookup"><span data-stu-id="60df7-106">Native images are created by translating managed code assemblies into files containing native machine instructions before the application is executed, relieving the .NET JIT (Just-In-Time) compiler from having to generate the native instructions at application runtime.</span></span>  

<span data-ttu-id="60df7-107">Avant la version 6, les bibliothèques du runtime EF core faisaient partie du .NET Framework et les images natives ont été générés automatiquement pour les.</span><span class="sxs-lookup"><span data-stu-id="60df7-107">Prior to version 6, the EF runtime’s core libraries were part of the .NET Framework and native images were generated automatically for them.</span></span> <span data-ttu-id="60df7-108">Depuis la version 6 le runtime EF entière a été combiné dans le package EntityFramework NuGet.</span><span class="sxs-lookup"><span data-stu-id="60df7-108">Starting with version 6 the whole EF runtime has been combined into the EntityFramework NuGet package.</span></span> <span data-ttu-id="60df7-109">Les images natives ont à présent être généré à l’aide de l’outil de ligne de commande NGen.exe pour obtenir des résultats similaires.</span><span class="sxs-lookup"><span data-stu-id="60df7-109">Native images have to now be generated using the NGen.exe command line tool to obtain similar results.</span></span>  

<span data-ttu-id="60df7-110">Observations empiriques montrent que les images natives des assemblys de runtime EF peuvent couper entre 1 et 3 secondes de temps de démarrage d’application.</span><span class="sxs-lookup"><span data-stu-id="60df7-110">Empirical observations show that native images of the EF runtime assemblies can cut between 1 and 3 seconds of application startup time.</span></span>  

## <a name="how-to-use-ngenexe"></a><span data-ttu-id="60df7-111">L’utilisation de NGen.exe</span><span class="sxs-lookup"><span data-stu-id="60df7-111">How to use NGen.exe</span></span>  

<span data-ttu-id="60df7-112">La fonction la plus simple de l’outil NGen.exe consiste à « installer » (autrement dit, pour créer et rendre persistantes sur disque) des images natives pour un assembly et toutes ses dépendances directes.</span><span class="sxs-lookup"><span data-stu-id="60df7-112">The most basic function of the NGen.exe tool is to “install” (that is, to create and persist to disk) native images for an assembly and all its direct dependencies.</span></span> <span data-ttu-id="60df7-113">Voici comment vous pouvez effectuer cette opération :</span><span class="sxs-lookup"><span data-stu-id="60df7-113">Here is how you can achieve that:</span></span>  

1. <span data-ttu-id="60df7-114">Ouvrez une fenêtre d’invite de commandes en tant qu’administrateur</span><span class="sxs-lookup"><span data-stu-id="60df7-114">Open a Command Prompt window as an administrator</span></span>  
2. <span data-ttu-id="60df7-115">Modifier le répertoire de travail actuel à l’emplacement des assemblys que vous souhaitez générer des images natives pour :</span><span class="sxs-lookup"><span data-stu-id="60df7-115">Change the current working directory to the location of the assemblies you want to generate native images for:</span></span>  

  ``` console
    cd <*Assemblies location*>  
  ```
3. <span data-ttu-id="60df7-116">Selon votre système d’exploitation et configuration de l’application, vous devrez peut-être à générer des images natives pour architecture 32 bits, architecture 64 bits ou les deux.</span><span class="sxs-lookup"><span data-stu-id="60df7-116">Depending on your operating system and the application’s configuration you might need to generate native images for 32 bit architecture, 64 bit architecture or for both.</span></span>  

    <span data-ttu-id="60df7-117">Pour 32 bits à exécuter :</span><span class="sxs-lookup"><span data-stu-id="60df7-117">For 32 bit run:</span></span>  
  ``` console
    %WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install <Assembly name>  
  ```
    <span data-ttu-id="60df7-118">Pour les 64 bits à exécuter :</span><span class="sxs-lookup"><span data-stu-id="60df7-118">For 64 bit run:</span></span>
  ``` console
    %WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install <Assembly name>  
  ```

> [!TIP]
> <span data-ttu-id="60df7-119">Génération d’images natives pour la bonne architecture est très fréquente.</span><span class="sxs-lookup"><span data-stu-id="60df7-119">Generating native images for the wrong architecture is a very common mistake.</span></span> <span data-ttu-id="60df7-120">Dans le doute, vous pouvez simplement générer des images natives pour toutes les architectures qui s’appliquent au système d’exploitation installé sur l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="60df7-120">When in doubt you can simply generate native images for all the architectures that apply to the operating system installed in the machine.</span></span>  

<span data-ttu-id="60df7-121">NGen.exe prend également en charge les autres fonctions telles que la désinstallation et afficher les images natives installées, queuing la génération de plusieurs images, etc. Pour plus d’informations sur l’utilisation, consultez le [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span><span class="sxs-lookup"><span data-stu-id="60df7-121">NGen.exe also supports other functions such as uninstalling and displaying the installed native images, queuing the generation of multiple images, etc. For more details of usage read the [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span></span>  

## <a name="when-to-use-ngenexe"></a><span data-ttu-id="60df7-122">Quand utiliser NGen.exe</span><span class="sxs-lookup"><span data-stu-id="60df7-122">When to use NGen.exe</span></span>  

<span data-ttu-id="60df7-123">Lorsqu’il s’agit de décider quels assemblys pour générer des images natives pour dans une application basée sur Entity Framework 6 ou version ultérieure, vous devez envisager les options suivantes :</span><span class="sxs-lookup"><span data-stu-id="60df7-123">When it comes to decide which assemblies to generate native images for in an application based on EF version 6 or greater, you should consider the following options:</span></span>  

- <span data-ttu-id="60df7-124">**Le principal assembly du runtime EF, EntityFramework.dll**: une application Entity Framework en fonction de type exécute une quantité importante de code à partir de cet assembly sur le démarrage ou sur son premier accès à la base de données.</span><span class="sxs-lookup"><span data-stu-id="60df7-124">**The main EF runtime assembly, EntityFramework.dll**: A typical EF based application executes a significant amount of code from this assembly on startup or on its first access to the database.</span></span> <span data-ttu-id="60df7-125">Par conséquent, la création d’images natives de cet assembly produira les plus grands gains de performances de démarrage.</span><span class="sxs-lookup"><span data-stu-id="60df7-125">Consequently, creating native images of this assembly will produce the biggest gains in startup performance.</span></span>  
- <span data-ttu-id="60df7-126">**N’importe quel assembly de fournisseur Entity Framework utilisé par votre application**: temps de démarrage peuvent également bénéficier légèrement de génération d’images natives d'entre eux.</span><span class="sxs-lookup"><span data-stu-id="60df7-126">**Any EF provider assembly used by your application**: Startup time can also benefit slightly from generating native images of these.</span></span> <span data-ttu-id="60df7-127">Par exemple, si l’application utilise le fournisseur Entity Framework pour SQL Server vous devez générer une image native pour EntityFramework.SqlServer.dll.</span><span class="sxs-lookup"><span data-stu-id="60df7-127">For example, if the application uses the EF provider for SQL Server you will want to generate a native image for EntityFramework.SqlServer.dll.</span></span>  
- <span data-ttu-id="60df7-128">**Assemblys de votre application et autres dépendances**: le [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx) couvre les critères généraux permettant de choisir quels assemblys pour générer des images natives pour et l’impact des images natives sur la sécurité, options avancées telles que « liaison matérielle », des scénarios tels que l’utilisation d’images natives lors du débogage et profilage des scénarios, etc.</span><span class="sxs-lookup"><span data-stu-id="60df7-128">**Your application’s assemblies and other dependencies**: The [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx) covers general criteria for choosing which assemblies to generate native images for and the impact of native images on security, advanced options such as “hard binding”, scenarios such as using native images in debugging and profiling scenarios, etc.</span></span>  

> [!TIP]
> <span data-ttu-id="60df7-129">Assurez-vous que vous avec soin de mesurer l’impact de l’utilisation des images natives sur les performances de démarrage et les performances globales de votre application et de les comparez par rapport à la configuration requise réelle.</span><span class="sxs-lookup"><span data-stu-id="60df7-129">Make sure you carefully measure the impact of using native images on both the startup performance and the overall performance of your application and compare them against actual requirements.</span></span> <span data-ttu-id="60df7-130">Tandis que les images natives sont généralement aident à améliorer le démarrage, les performances et dans certains cas, réduire l’utilisation de mémoire, pas tous les scénarios bénéficieront également.</span><span class="sxs-lookup"><span data-stu-id="60df7-130">While native images will generally help improve startup up performance and in some cases reduce memory usage, not all scenarios will benefit equally.</span></span> <span data-ttu-id="60df7-131">Par exemple, lors de l’exécution d’un état stable (autrement dit, une fois que toutes les méthodes utilisées par l’application ont été appelées au moins une fois) code généré par le compilateur JIT peut en fait produire des performances légèrement meilleures que les images natives.</span><span class="sxs-lookup"><span data-stu-id="60df7-131">For instance, on steady state execution (that is, once all the methods being used by the application have been invoked at least once) code generated by the JIT compiler can in fact yield slightly better performance than native images.</span></span>  

## <a name="using-ngenexe-in-a-development-machine"></a><span data-ttu-id="60df7-132">À l’aide de NGen.exe dans un ordinateur de développement</span><span class="sxs-lookup"><span data-stu-id="60df7-132">Using NGen.exe in a development machine</span></span>  

<span data-ttu-id="60df7-133">Pendant le développement, le JIT .NET compilateur offrira le meilleur compromis global pour le code qui change fréquemment.</span><span class="sxs-lookup"><span data-stu-id="60df7-133">During development the .NET JIT compiler will offer the best overall tradeoff for code that is changing frequently.</span></span> <span data-ttu-id="60df7-134">Génération d’images natives pour les dépendances compilés tels que les assemblys de runtime EF peut aider à accélérer le développement et le test en découpant quelques secondes au début de chaque exécution.</span><span class="sxs-lookup"><span data-stu-id="60df7-134">Generating native images for compiled dependencies such as the EF runtime assemblies can help accelerate development and testing by cutting a few seconds out at the beginning of each execution.</span></span>  

<span data-ttu-id="60df7-135">Un bon point de rechercher les assemblys de runtime EF est l’emplacement du package NuGet pour la solution.</span><span class="sxs-lookup"><span data-stu-id="60df7-135">A good place to find the EF runtime assemblies is the NuGet package location for the solution.</span></span> <span data-ttu-id="60df7-136">Par exemple, pour une application à l’aide d’EF 6.0.2 avec SQL Server et de ciblage .NET 4.5 ou version ultérieure vous pouvez taper ce qui suit dans une fenêtre d’invite de commandes (n’oubliez pas pour l’ouvrir en tant qu’administrateur) :</span><span class="sxs-lookup"><span data-stu-id="60df7-136">For example, for an application using EF 6.0.2 with SQL Server and targeting .NET 4.5 or greater you can type the following in a Command Prompt window (remember to open it as an administrator):</span></span>  

``` console
cd <Solution directory>\packages\EntityFramework.6.0.2\lib\net45
%WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install EntityFramework.SqlServer.dll
%WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install EntityFramework.SqlServer.dll
```  

> [!NOTE]
> <span data-ttu-id="60df7-137">Il tire parti du fait que l’installation des images natives pour le fournisseur Entity Framework pour SQL Server par défaut installe également les images natives pour l’assembly de runtime EF principal.</span><span class="sxs-lookup"><span data-stu-id="60df7-137">This takes advantage of the fact that installing the native images for EF provider for SQL Server will also by default install the native images for the main EF runtime assembly.</span></span> <span data-ttu-id="60df7-138">Cela fonctionne car NGen.exe peut détecter que EntityFramework.dll est une dépendance directe de l’assembly EntityFramework.SqlServer.dll situé dans le même répertoire.</span><span class="sxs-lookup"><span data-stu-id="60df7-138">This works because NGen.exe can detect that EntityFramework.dll is a direct dependency of the EntityFramework.SqlServer.dll assembly located in the same directory.</span></span>  

## <a name="creating-native-images-during-setup"></a><span data-ttu-id="60df7-139">Création d’images natives lors de l’installation</span><span class="sxs-lookup"><span data-stu-id="60df7-139">Creating native images during setup</span></span>  

<span data-ttu-id="60df7-140">Le WiX Toolkit prend en charge queuing la génération d’images natives pour les assemblys managés pendant l’installation, comme expliqué dans cet [guide de procédure](http://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html).</span><span class="sxs-lookup"><span data-stu-id="60df7-140">The WiX Toolkit supports queuing the generation of native images for managed assemblies during setup, as explained in this [how-to guide](http://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html).</span></span> <span data-ttu-id="60df7-141">Une autre solution consiste à créer une tâche d’installation personnalisée qui exécute la commande NGen.exe.</span><span class="sxs-lookup"><span data-stu-id="60df7-141">Another alternative is to create a custom setup task that execute the NGen.exe command.</span></span>  

## <a name="verifying-that-native-images-are-being-used-for-ef"></a><span data-ttu-id="60df7-142">Vérification que les images natives sont utilisées pour Entity Framework</span><span class="sxs-lookup"><span data-stu-id="60df7-142">Verifying that native images are being used for EF</span></span>  

<span data-ttu-id="60df7-143">Vous pouvez vérifier qu’une application spécifique est à l’aide d’un assembly natif en recherchant des assemblys chargés qui ont l’extension «. ni.dll « ou ». ni.exe ».</span><span class="sxs-lookup"><span data-stu-id="60df7-143">You can verify that a specific application is using a native assembly by looking for loaded assemblies that have the extension “.ni.dll” or “.ni.exe”.</span></span> <span data-ttu-id="60df7-144">Par exemple, une image native pour l’assembly de runtime principal de l’Entity Framework s’appellera EntityFramework.ni.dll.</span><span class="sxs-lookup"><span data-stu-id="60df7-144">For example, a native image for the EF’s main runtime assembly will be called EntityFramework.ni.dll.</span></span> <span data-ttu-id="60df7-145">Un moyen simple pour inspecter les assemblys .NET chargés d’un processus consiste à utiliser [Process Explorer](https://technet.microsoft.com/sysinternals/bb896653).</span><span class="sxs-lookup"><span data-stu-id="60df7-145">An easy way to inspect the loaded .NET assemblies of a process is to use [Process Explorer](https://technet.microsoft.com/sysinternals/bb896653).</span></span>  

## <a name="other-things-to-be-aware-of"></a><span data-ttu-id="60df7-146">Autres choses à connaître</span><span class="sxs-lookup"><span data-stu-id="60df7-146">Other things to be aware of</span></span>  

<span data-ttu-id="60df7-147">**Création d’une image native d’un assembly pas confondre avec l’inscription de l’assembly dans le [GAC (Global Assembly Cache)](https://msdn.microsoft.com/library/yf1d93sz.aspx)**.</span><span class="sxs-lookup"><span data-stu-id="60df7-147">**Creating a native image of an assembly should not be confused with registering the assembly in the [GAC (Global Assembly Cache)](https://msdn.microsoft.com/library/yf1d93sz.aspx)**.</span></span> <span data-ttu-id="60df7-148">NGen.exe permet la création d’images d’assemblys qui ne figurent pas dans le GAC, et en fait, plusieurs applications qui utilisent une version spécifique d’EF peuvent partager la même image de native.</span><span class="sxs-lookup"><span data-stu-id="60df7-148">NGen.exe allows creating images of assemblies that are not in the GAC, and in fact, multiple applications that use a specific version of EF can share the same native image.</span></span> <span data-ttu-id="60df7-149">Bien que Windows 8 peut créer automatiquement des images natives pour les assemblys placés dans le GAC, le runtime Entity Framework est optimisé pour être déployé en même temps que votre application et nous ne recommandons pas l’inscription dans le GAC comme cela a un impact négatif sur la résolution d’assembly et vos applications parmi les autres aspects de la maintenance.</span><span class="sxs-lookup"><span data-stu-id="60df7-149">While Windows 8 can automatically create native images for assemblies placed in the GAC, the EF runtime is optimized to be deployed alongside your application and we do not recommend registering it in the GAC as this has a negative impact on assembly resolution and servicing your applications among other aspects.</span></span>  
